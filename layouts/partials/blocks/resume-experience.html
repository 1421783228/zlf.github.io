{{ $block := .Block }}
{{ $page := .page }}

{{ $username := $block.content.username | default $page.Params.author }}

{{ $person_page_path := (printf "/authors/%s" $username) }}
{{ $person_page := site.GetPage $person_page_path }}
{{ if not $person_page }}
  {{ errorf "Could not find an author page at `%s`. Please check the value of `author` in your Site Params." $person_page_path }}
{{ end }}

{{ $date_format := $block.design.date_format | default "January 2006" }}

{{ $show_education_first := $block.design.is_education_first | default false }}

<div class="row">
  <div class="col-12 col-lg-8">
    {{ with $person_page }}
      {{ if $show_education_first }}
        {{ with .Params.education }}
          <div class="row experience">
            <div class="col-auto text-center flex-column d-none d-sm-flex">
              <div class="row h-50">
                <div class="col border-end">&nbsp;</div>
                <div class="col">&nbsp;</div>
              </div>
            </div>
            <div class="col py-2">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title exp-title text-muted mt-0 mb-1">Education Background</h4>
                  {{ range .Params.education }}
                    <div class="card-text">
                      <div class="section-subheading card-title exp-title text-muted my-0">{{ .area | markdownify }}</div>
                      <div class="exp-meta">
                        <span class="middot-divider"></span>
                        <span>{{ .institution | markdownify }}</span>
                        <span class="middot-divider"></span>
                        <span>{{ .date_start | time.Format $date_format }} –
                          {{ if .date_end}}
                            {{ .date_end | time.Format $date_format }}
                          {{ else }}
                            {{ i18n "present" | default "Present" }}
                          {{ end }}
                        </span>
                      </div>
                      {{ with .summary }}<div class="card-text">{{ . | markdownify }}</div>{{ end }}
                      {{ with .button }}
                      <a class="btn btn-outline-primary btn-page-header btn-sm" href="{{ .url }}" target="_blank">
                        {{ .text | markdownify | emojify }}
                      </a>
                      {{ end }}
                    </div>
                  {{ end }}
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}

      {{ with .Params.work }}
        <div class="row experience">
          <div class="col-auto text-center flex-column d-none d-sm-flex">
            <div class="row h-50">
              <div class="col border-end">&nbsp;</div>
              <div class="col">&nbsp;</div>
            </div>
          </div>
          <div class="col py-2">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title exp-title text-muted mt-0 mb-1">Internship Experience</h4>
                {{ range . }}
                  <div class="card-text">
                    <div class="section-subheading card-title exp-title text-muted my-0">{{ .position | markdownify }}</div>
                    <div class="exp-meta">
                      <span>{{ .company_name | markdownify }}</span>
                      <span class="middot-divider"></span>
                      <span>{{ .date_start | time.Format $date_format }} –
                        {{ if .date_end}}
                          {{ .date_end | time.Format $date_format }}
                        {{ else }}
                          {{ i18n "present" | default "Present" }}
                        {{ end }}
                      </span>
                    </div>
                    {{ with .summary }}<div class="card-text">{{ . | markdownify }}</div>{{ end }}
                  </div>
                {{ end }}
              </div>
            </div>
          </div>
        </div>
      {{ end }}

      {{ if not $show_education_first }}
        {{ with .Params.education }}
          <div class="row experience">
            <div class="col-auto text-center flex-column d-none d-sm-flex">
              <div class="row h-50">
                <div class="col border-end">&nbsp;</div>
                <div class="col">&nbsp;</div>
              </div>
            </div>
            <div class="col py-2">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title exp-title text-muted mt-0 mb-1">Education Background</h4>
                  {{ range . }}
                    <div class="card-text">
                      <div class="section-subheading card-title exp-title text-muted my-0">{{ .area | markdownify }}</div>
                      <div class="exp-meta">
                        <span>{{ .institution | markdownify }}</span>
                        <span class="middot-divider"></span>
                        <span>{{ .date_start | time.Format $date_format }} –
                          {{ if .date_end}}
                            {{ .date_end | time.Format $date_format }}
                          {{ else }}
                            {{ i18n "present" | default "Present" }}
                          {{ end }}
                        </span>
                      </div>
                      {{ with .summary }}<div class="card-text">{{ . | markdownify }}</div>{{ end }}
                      {{ with .button }}
                      <a class="btn btn-outline-primary btn-page-header btn-sm" href="{{ .url }}" target="_blank">
                        {{ .text | markdownify | emojify }}
                      </a>
                      {{ end }}
                    </div>
                  {{ end }}
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}
    {{ end }}
  </div>
</div>
